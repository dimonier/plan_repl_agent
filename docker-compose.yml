services:
  agent:
    container_name: agent
    build: .
    ports:
      - "127.0.0.1:8000:8000"  # Only localhost access
    volumes:
      - ./agent:/app/agent  # Agent code (auto-reload if enabled)
      - ./work:/app/work  # Work dir for agent files (clean user space)
      - ./logs:/app/logs  # Logs visible on host
      - ./agent_spool:/app/agent_spool  # Spool dir for agent files (clean user space)
      - agent-venv:/app/venv  # Named volume (preserves venv between rebuilds)
    env_file:
      - .env
    environment:
      - TZ=Europe/Moscow
      - PIP_CACHE_DIR=/app/.pipcache
      - PIP_DISABLE_PIP_VERSION_CHECK=1
      - PIP_NO_INPUT=1
      - PIP_NO_WARN_SCRIPT_LOCATION=1
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    restart: unless-stopped

volumes:
  agent-venv:
